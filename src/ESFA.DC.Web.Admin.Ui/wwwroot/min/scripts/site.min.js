function Maths(){this.type=type;this.color="red";this.getInfo=getAppleInfo}var baseApiUrl=$("#url").val();$(function(){function u(){r===!0?($("#jsGrid").jsGrid("loadData"),h()):clearTimeout(t)}function h(){clearTimeout(t);t=setTimeout(u,3e3)}var i=[{Name:"Ready",Id:1},{Name:"Moved For processing",Id:2},{Name:"Processing",Id:3},{Name:"Completed",Id:4},{Name:"FailedRetry",Id:5},{Name:"Failed",Id:6},{Name:"Paused",Id:7},{Name:"Waiting",Id:8}],n;$("#jsGrid").jsGrid({width:"100%",height:"600px",inserting:!1,editing:!0,sorting:!0,paging:!0,autoload:!0,onDataLoaded:function(n){n!==null&&n.data!==null&&updateStats()},rowClass:function(n){var t=String(i[n.status-1].Name);return t.replace(/\s/g,"")},controller:{loadData:function(){return $.ajax({url:baseApiUrl+"/job/period/ILR1819",dataType:"json"})},deleteItem:function(n){var t=n;return $.ajax({url:baseApiUrl+"/job/"+n.jobId,dataType:"text",method:"DELETE",success:function(n){n===200&&$("#jsGrid").jsGrid("deleteItem",t)},error:function(){alert("Delete failed, Either job is moved to in progress or job is aunavailable")}})}},rowClick:function(){},fields:[{name:"jobId",title:"Job Id",type:"text",width:50,validate:"required"},{name:"jobType",title:"Job Type",type:"select",items:[{Name:"ILR",Id:1},{Name:"Reference data",Id:2}],valueField:"Id",textField:"Name",width:110,validate:"required"},{name:"status",title:"Status",type:"select",width:150,items:i,valueField:"Id",textField:"Name"},{name:"dateTimeSubmittedUtc",title:"Submitted Date time",type:"text",width:160},{name:"priority",type:"select",title:"Priority",width:50,items:[{Name:"1",Id:1},{Name:"2",Id:2},{Name:"3",Id:3},{Name:"4",Id:4},{Name:"5",Id:5}],valueField:"Id",textField:"Name"},{name:"dateTimeUpdatedUtc",title:"Updated Date time",type:"text",width:160},{name:"ukprn",type:"number",title:"Ukprn",width:80},{name:"fileName",type:"text",title:"File Name",width:100},{name:"rowVersion",type:"text",title:"",width:0,visible:!1},{type:"control",editButton:!1,itemTemplate:function(n,t){var r=$("<i>").attr({"class":"glyphicon glyphicon-repeat"}),u=$("<i>").attr({"class":"glyphicon glyphicon-upload"}),f=$("<i>").attr({"class":"glyphicon glyphicon-trash"}),e=$("<button>").attr({"class":"btn btn-default btn-xs"}).attr({role:"button"}).attr({title:"Retry"}).attr({id:"btn-edit-"+t.id}).click(function(n){o(n,t);n.stopPropagation()}).append(r),h=$("<input type='file' id='file_"+t.jobId+"' hidden style='display:none'>").click(function(n){n.stopPropagation()}).change(function(n){s(n,t);n.stopPropagation()}),c=$("<button>").attr({"class":"btn btn-default btn-xs"}).attr({role:"button"}).attr({title:"Upload"}).attr({id:"btn-edit-"+t.jobId}).click(function(n){$("#file_"+t.jobId)[0].click(n)}).append(u),l=$("<button>").attr({"class":"btn btn-danger btn-xs"}).attr({role:"button"}).attr({title:jsGrid.fields.control.prototype.deleteButtonTooltip}).attr({id:"btn-delete-"+t.id}).click(function(n){deleteJob(t);n.stopPropagation()}).append(f),i=$("<div>").attr({"class":"btn-toolbar"});return t.status===6&&i.append(e),t.status===1&&i.append(l),(t.status===5||t.status===6)&&(i.append(c),i.append(h)),i}}]});n=$.noop;$("#detailsDialog").dialog({autoOpen:!1,width:400,close:function(){$("#detailsForm").validate().resetForm();$("#detailsForm").find(".error").removeClass("error")}});$("#detailsForm").validate({rules:{status:"required",priority:{required:!0,range:[1,5]}},messages:{status:"Please enter valid status",priority:"Please enter valid priority"},submitHandler:function(){n()}});var c=function(t,i){$("#status").val(i.status);$("#priority").val(i.priority);$("#ukprn").val(i.ukprn);$("#jobType").val(i.jobType);$("#fileName").val(i.fileName);$("#jobId").val(i.jobId);$("#rowVersion").val(i.rowVersion);$("#ukprn").prop("disabled",!1);$("#jobType").prop("disabled",!1);$("#fileName").prop("disabled",!1);$("#status").prop("disabled",!1);$("#priority").prop("disabled",!1);i.jobId>0&&($("#ukprn").prop("disabled",!0),$("#jobType").prop("disabled",!0),$("#fileName").prop("disabled",!0),i.status!==1&&$("#priority").prop("disabled",!0));n=function(){f(i,t==="Add")};$("#detailsDialog").dialog("option","title",t+" Job - Job Id : "+i.jobId).dialog("open")},f=function(n,t){$.extend(n,{priority:parseInt($("#priority").val()),status:parseInt($("#status").val()),jobId:parseInt($("#jobId").val()),ukprn:parseInt($("#ukprn").val()),fileName:$("#fileName").val(),jobType:parseInt($("#jobType").val()),rowVersion:$("#rowVersion").val()});n.jobId=isNaN(n.jobId)?0:n.jobId;$.ajax({url:baseApiUrl+"/job",dataType:"json",method:"POST",contentType:"application/json",data:JSON.stringify(n)}).complete(function(i){i.status===200?(n.jobId=t?i.responseJSON:n.jobId,$("#jsGrid").jsGrid(t?"insertItem":"updateItem",n),$("#detailsDialog").dialog("close"),updateStats()):confirm("Update failed, Job status has been changed. Do you want to refresh the data?")&&($("#detailsDialog").dialog("close"),$("#jsGrid").jsGrid("loadData"))})},e=function(n){var t={jobStatus:1,jobId:n,numberOfLearners:0};$.ajax({url:baseApiUrl+"/job/status",dataType:"json",method:"POST",contentType:"application/json",data:JSON.stringify(t)}).complete(function(n){n.status===200?(alert("Job set to ready again."),$("#jsGrid").jsGrid("loadData"),updateStats()):alert("Update failed, Job status has been changed")&&$("#jsGrid").jsGrid("loadData")})},o=function(n,t){$.ajax({url:baseApiUrl+"/job/"+t.ukprn+"/"+t.collectionName+"/latest",method:"GET",contentType:"application/json"}).complete(function(n){if(n.status===200){var i=n.responseJSON;i.jobId>t.jobId&&i.isFirstStage==0&&(i.status==1||i.status==2||i.status==3)&&confirm("There is already a newer job with Id : + "+i.jobId+" set to be processed, Do you still want to set this job for retry?")&&e(t.jobId)}else alert("New job creation failed...")})},s=function(n,t){var i=new FormData;i.append("file",$("#file_"+t.jobId)[0].files[0]);i.append("fileName",$("#file_"+t.jobId)[0].files[0].name);$.ajax({url:baseApiUrl+"/file-upload/upload/"+t.jobId,method:"POST",contentType:!1,processData:!1,data:i}).complete(function(n){n.status===200?alert("Created new job with Id :"+n.responseText):alert("New job creation failed...")})},t,r;$("#autoRefresh").click(function(){r=this.checked;u()});$("#pauseQueue").click(function(){$.ajax({url:baseApiUrl+"/jobManager",headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",dataType:"json",data:this.value==="Pause Queue Processing"?"0":"1"}).complete(function(n){n.status===200?$("#pauseQueue").prop("value",$("#pauseQueue").prop("value")==="Start Queue Processing"?"Pause Queue Processing":"Start Queue Processing"):alert("Queue status changed failed, please try later.")})})});$(document).ready(function(){$.ajax({url:"http://localhost:2218/api/job/stats",method:"get",dataType:"json",success:function(n){$("#retriedTotal").html(n)}})});$(document).ready(function(){$.ajax({url:"http://localhost:2218/api/job/retried/ILR1819",method:"get",dataType:"json",success:function(n){$("#retriedTotal").html(n)}})});