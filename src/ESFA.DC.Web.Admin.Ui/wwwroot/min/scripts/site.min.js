function Maths(){this.type=type;this.color="red";this.getInfo=getAppleInfo}var baseApiUrl=$("#url").val(),updateStats,completedTimes;$(function(){function u(){r===!0?($("#jsGrid").jsGrid("loadData"),s()):clearTimeout(t)}function s(){clearTimeout(t);t=setTimeout(u,3e3)}var i=[{Name:"Ready",Id:1},{Name:"Moved For processing",Id:2},{Name:"Processing",Id:3},{Name:"Completed",Id:4},{Name:"FailedRetry",Id:5},{Name:"Failed",Id:6},{Name:"Paused",Id:7},{Name:"Waiting",Id:8}],n;$("#jsGrid").jsGrid({width:"100%",height:"600px",inserting:!1,editing:!0,sorting:!0,paging:!0,autoload:!0,onDataLoaded:function(n){n!==null&&n.data!==null&&updateStats()},rowClass:function(n){var t=String(i[n.status-1].Name);return t.replace(/\s/g,"")},controller:{loadData:function(){return $.ajax({url:baseApiUrl+"/job",dataType:"json"})},deleteItem:function(n){var t=n;return $.ajax({url:baseApiUrl+"/job/"+n.jobId,dataType:"text",method:"DELETE",success:function(n){n===200&&$("#jsGrid").jsGrid("deleteItem",t)},error:function(){alert("Delete failed, Either job is moved to in progress or job is aunavailable")}})}},rowClick:function(n){f("Edit",n.item)},fields:[{name:"jobId",title:"Job Id",type:"text",width:50,validate:"required"},{name:"jobType",title:"Job Type",type:"select",items:[{Name:"ILR",Id:1},{Name:"Reference data",Id:2}],valueField:"Id",textField:"Name",width:110,validate:"required"},{name:"status",title:"Status",type:"select",width:150,items:i,valueField:"Id",textField:"Name"},{name:"dateTimeSubmittedUtc",title:"Submitted Date time",type:"text",width:160},{name:"priority",type:"select",title:"Priority",width:50,items:[{Name:"1",Id:1},{Name:"2",Id:2},{Name:"3",Id:3},{Name:"4",Id:4},{Name:"5",Id:5}],valueField:"Id",textField:"Name"},{name:"dateTimeUpdatedUtc",title:"Updated Date time",type:"text",width:160},{name:"ukprn",type:"number",title:"Ukprn",width:80},{name:"fileName",type:"text",title:"File Name",width:100},{name:"rowVersion",type:"text",title:"",width:0,visible:!1},{type:"control",editButton:!1,itemTemplate:function(n,t){var r=$("<i>").attr({"class":"glyphicon glyphicon-repeat"}),u=$("<i>").attr({"class":"glyphicon glyphicon-trash"}),f=$("<button>").attr({"class":"btn btn-default btn-xs"}).attr({role:"button"}).attr({title:"Retry"}).attr({id:"btn-edit-"+t.id}).click(function(n){alert("ID: "+t.jobId);o(t);n.stopPropagation()}).append(r),e=$("<button>").attr({"class":"btn btn-danger btn-xs"}).attr({role:"button"}).attr({title:jsGrid.fields.control.prototype.deleteButtonTooltip}).attr({id:"btn-delete-"+t.id}).click(function(n){alert("ID: "+t.id);n.stopPropagation()}).append(u),i=$("<div>").attr({"class":"btn-toolbar"});return(t.status===5||t.status===6)&&i.append(f),t.status===1&&i.append(e),i}}]});n=$.noop;$("#detailsDialog").dialog({autoOpen:!1,width:400,close:function(){$("#detailsForm").validate().resetForm();$("#detailsForm").find(".error").removeClass("error")}});$("#detailsForm").validate({rules:{status:"required",priority:{required:!0,range:[1,5]}},messages:{status:"Please enter valid status",priority:"Please enter valid priority"},submitHandler:function(){n()}});var f=function(t,i){$("#status").val(i.status);$("#priority").val(i.priority);$("#ukprn").val(i.ukprn);$("#jobType").val(i.jobType);$("#fileName").val(i.fileName);$("#jobId").val(i.jobId);$("#rowVersion").val(i.rowVersion);$("#ukprn").prop("disabled",!1);$("#jobType").prop("disabled",!1);$("#fileName").prop("disabled",!1);$("#status").prop("disabled",!1);$("#priority").prop("disabled",!1);i.jobId>0&&($("#ukprn").prop("disabled",!0),$("#jobType").prop("disabled",!0),$("#fileName").prop("disabled",!0),i.status!==1&&$("#priority").prop("disabled",!0));n=function(){e(i,t==="Add")};$("#detailsDialog").dialog("option","title",t+" Job - Job Id : "+i.jobId).dialog("open")},e=function(n,t){$.extend(n,{priority:parseInt($("#priority").val()),status:parseInt($("#status").val()),jobId:parseInt($("#jobId").val()),ukprn:parseInt($("#ukprn").val()),fileName:$("#fileName").val(),jobType:parseInt($("#jobType").val()),rowVersion:$("#rowVersion").val()});n.jobId=isNaN(n.jobId)?0:n.jobId;$.ajax({url:baseApiUrl+"/job",dataType:"json",method:"POST",contentType:"application/json",data:JSON.stringify(n)}).complete(function(i){i.status===200?(n.jobId=t?i.responseJSON:n.jobId,$("#jsGrid").jsGrid(t?"insertItem":"updateItem",n),$("#detailsDialog").dialog("close"),updateStats()):confirm("Update failed, Job status has been changed. Do you want to refresh the data?")&&($("#detailsDialog").dialog("close"),$("#jsGrid").jsGrid("loadData"))})},o=function(n){var t={jobStatus:1,jobId:n.jobId};$.ajax({url:baseApiUrl+"/job",dataType:"json",method:"POST",contentType:"application/json",data:JSON.stringify(t)}).complete(function(n){n.status===200?($("#jsGrid").jsGrid(isNew?"insertItem":"updateItem",t),updateStats()):alert("Update failed, Job status has been changed")&&$("#jsGrid").jsGrid("loadData")})},t,r;$("#autoRefresh").click(function(){r=this.checked;u()});$("#pauseQueue").click(function(){$.ajax({url:baseApiUrl+"/jobManager",headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",dataType:"json",data:this.value==="Pause Queue Processing"?"0":"1"}).complete(function(n){n.status===200?$("#pauseQueue").prop("value",$("#pauseQueue").prop("value")==="Start Queue Processing"?"Pause Queue Processing":"Start Queue Processing"):alert("Queue status changed failed, please try later.")})})});updateStats=function(){var n=$("#jsGrid").jsGrid("option","data"),t,i,r;n!=null&&($("#total").html(n.length),$("#readyTotal").html($.grep(n,function(n){return n.status===1}).length),$("#completedTotal").html($.grep(n,function(n){return n.status===4}).length),$("#failedRetryTotal").html($.grep(n,function(n){return n.status===5}).length),$("#failedTotal").html($.grep(n,function(n){return n.status===6}).length),$("#movedForProcessingTotal").html($.grep(n,function(n){return n.status===2}).length),$("#pausedTotal").html($.grep(n,function(n){return n.status===7}).length),$("#processingTotal").html($.grep(n,function(n){return n.status===3}).length),t=completedTimes(n),t!=null&&t.length>0&&($("#minProcessTime").html(new Date(arr.min(t)*1e3).toISOString().substr(11,8)),$("#maxProcessTime").html(new Date(arr.max(t)*1e3).toISOString().substr(11,8)),$("#meanProcessTime").html(new Date(arr.mean(t)*1e3).toISOString().substr(11,8)),$("#medianProcessTime").html(new Date(arr.median(t)*1e3).toISOString().substr(11,8))),$("#ilrTotal").html($.grep(n,function(n){return n.status===2&&n.jobType===1}).length),$("#refTotal").html($.grep(n,function(n){return n.status===2&&n.jobType===2}).length),i=document.getElementById("stats").getContext("2d"),i.height=100,r=new Chart(i,{type:"pie",data:{datasets:[{data:[$.grep(n,function(n){return n.status===1}).length,$.grep(n,function(n){return n.status===2}).length,$.grep(n,function(n){return n.status===3}).length,$.grep(n,function(n){return n.status===4}).length,$.grep(n,function(n){return n.status===5}).length,$.grep(n,function(n){return n.status===6}).length,$.grep(n,function(n){return n.status===7}).length],backgroundColor:["#C6E9F5","#109ABD","#37b6b5","#BFED91","#E6BB77","#F55840","#FFC300"]}],labels:["Ready","Moved for processing","Processing","Completed","Failed rety","Failed","Paused"]},options:{responsive:!0,legend:{display:!0},maintainAspectRatio:!1}}))};completedTimes=function(n){var i=$.grep(n,function(n){return n.status===4&&n.jobType===1}),t=[];return $.each(i,function(n,i){t.push(Math.abs((new Date(i.dateTimeUpdatedUtc).getTime()-new Date(i.dateTimeSubmittedUtc).getTime())/1e3))}),console.log(t),t};